<!DOCTYPE html>
<html lang="en">
  <head>
    <title style ="font-weight:bold;">MTA Crunch</title>
      <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  </head>
  <body>
    <h1 style="font-family: 'Helvetica';font-weight: bold;">MTA Crunch</h1>
    <div class ="container">

    <img src="/public/1.png" width="34" onclick= "setLine('1');"/>
    <img src="/public/2.png" width="34" onclick= "setLine('2');"/>
    <img src="/public/3.png" width="34" onclick= "setLine('3');"/>
    <img src="/public/4.png" width="34" onclick= "setLine('4');"/>
    <img src="/public/5.png" width="34" onclick= "setLine('5');"/>
    <img src="/public/6.png" width="34" onclick= "setLine('6');"/>
    <img src="/public/7.png" width="34" onclick= "setLine('7');"/>
    <img src="/public/a.png" width="34" onclick= "setLine('A');"/>
    <img src="/public/c.png" width="34" onclick= "setLine('C');"/>
    <img src="/public/e.png" width="34" onclick= "setLine('E');"/>
    <img src="/public/b.png" width="34" onclick= "setLine('B');"/>
    <img src="/public/d.png" width="34" onclick= "setLine('D');"/>
    <img src="/public/f.png" width="34" onclick= "setLine('F');"/>
    <img src="/public/m.png" width="34" onclick= "setLine('M');"/>
    <img src="/public/g.png" width="34" onclick= "setLine('G');"/>
    <img src="/public/j.png" width="34" onclick= "setLine('J');"/>
    <img src="/public/z.png" width="34" onclick= "setLine('Z');"/>
    <img src="/public/l.png" width="34" onclick= "setLine('L');"/>
    <img src="/public/n.png" width="34" onclick= "setLine('N');"/>
    <img src="/public/q.png" width="34" onclick= "setLine('Q');"/>
    <img src="/public/r.png" width="34" onclick= "setLine('R');"/>
    <img src="/public/w.png" width="34" onclick= "setLine('W');"/>




    <div class="row">
      <br/>
      <div class = "container style="background-color:lightgrey;">
        <h5 id = "lineText"></h5>
        

      </div>
    </div>
    <div class="row">
    <div class="one-half column" >
      <p>Departure Station:
      <input type="text" id="sStation" name="Starting Station" required
         minlength="4" maxlength="30" size="25"/></p>
    </div>

    <div class="one-half column" >
      <p>Arrival Station:
      <input type="text" id="eStation" name="Starting Station" required
        minlength="4" maxlength="30" size="25" /></p>
    </div>
  </div>

    </div>
    <br>
    <input id="request_commute" type="button" value="get commute time" onclick= "getCommute();"/>
    </div>
    <h5 id ="return"> </h6>
    <br>
    <div class="slidecontainer">
      
      <input oninput = "sliderTouch();" id = "confidence-slider" type="range" min="1" max="100" value="50" class="slider" id="myRange"/>
      <p id = "confidence-text"><p>
    </div>
    <br>
    <p id ="data"> </p>




    <script>




      const table = {"1":["Van Cortlandt Park - 242 St", "238 St", "231 St", "Marble Hill - 225 St", "215 St", "207 St", "Dyckman St", "191 St", "181 St", "168 St - Washington Hts", "157 St", "145 St", "137 St - City College", "125 St", "116 St - Columbia University", "Cathedral Pkwy (110 St)", "103 St", "96 St", "86 St", '79 St', '72 St', '66 St - Lincoln Center', '59 St - Columbus Circle', '50 St', 'Times Sq - 42 St', '34 St - Penn Station', '23 St', '18 St', '14 St', 'Christopher St - Sheridan Sq', 'Houston St', 'Canal St', 'Franklin St', 'Chambers St', 'WTC Cortlandt', 'Rector St', 'South Ferry'],
      "2":['Wakefield - 241 St', 'Nereid Av', '233 St', '225 St', '219 St', 'Gun Hill Rd', 'Burke Av', 'Allerton Av', 'Pelham Pkwy', 'Bronx Park East', 'E 180 St', 'West Farms Sq - E Tremont Av', '174 St', 'Freeman St', 'Simpson St', 'Intervale Av', 'Prospect Av', '3 Av - 149 St', '149 St - Grand Concourse', '135 St', '125 St', '116 St', 'Central Park North (110 St)', '96 St', '86 St', '79 St', '72 St', '66 St - Lincoln Center', '59 St - Columbus Circle', '50 St', 'Times Sq - 42 St', '34 St - Penn Station', '28 St', '23 St', '18 St', '14 St', 'Christopher St - Sheridan Sq', 'Houston St', 'Canal St', 'Franklin St', 'Chambers St', 'Park Pl', 'Fulton St', 'Wall St', 'Clark St', 'Borough Hall', 'Hoyt St', 'Nevins St', 'Atlantic Av', 'Bergen St', 'Grand Army Plaza', 'Eastern Pkwy - Brooklyn Museum', 'Franklin Av', 'President St', 'Sterling St', 'Winthrop St', 'Church Av', 'Beverly Rd', 'Newkirk Av', 'Flatbush Av - Brooklyn College'],
      '3':['Harlem - 148 St', '145 St', '135 St', '116 St', 'Central Park North (110 St)', '96 St', '72 St', 'Times Sq - 42 St', '34 St - Penn Station', '14 St', 'Chambers St', 'Park Pl', 'Fulton St', 'Wall St', 'Clark St', 'Borough Hall', 'Hoyt St', 'Nevins St', 'Atlantic Av', 'Bergen St', 'Grand Army Plaza', 'Eastern Pkwy - Brooklyn Museum', 'Franklin Av', 'Nostrand Av', 'Kingston Av', 'Crown Hts - Utica Av', 'Sutter Av - Rutland Rd', 'Saratoga Av', 'Rockaway Av', 'Junius St', 'Pennsylvania Av', 'Van Siclen Av', 'New Lots Av'],
      '4':['Woodlawn', 'Mosholu Pkwy', 'Bedford Park Blvd - Lehman College', 'Kingsbridge Rd', 'Fordham Rd', '183 St', 'Burnside Av', '176 St', 'Mt Eden Av', '170 St', '167 St', '161 St - Yankee Stadium', '149 St - Grand Concourse', '138 St - Grand Concourse', '125 St', '116 St', '110 St', '103 St', '96 St', '86 St', '77 St', '68 St - Hunter College', '59 St', '51 St', 'Grand Central - 42 St', '33 St', '28 St', '23 St', '14 St - Union Sq', 'Astor Pl', 'Broadway-Lafayette St', 'Spring St', 'Canal St', 'Brooklyn Bridge - City Hall', 'Fulton St', 'Wall St', 'Bowling Green', 'Borough Hall', 'Nevins St', 'Atlantic Av', 'Bergen St', 'Grand Army Plaza', 'Eastern Pkwy - Brooklyn Museum', 'Franklin Av', 'Nostrand Av', 'Kingston Av', 'Crown Hts - Utica Av', 'Sutter Av - Rutland Rd', 'Saratoga Av', 'Rockaway Av', 'Junius St', 'Pennsylvania Av', 'Van Siclen Av', 'New Lots Av'],
      '5':['Eastchester - Dyre Av', 'Baychester Av', 'Gun Hill Rd', 'Pelham Pkwy', 'Morris Park', 'Nereid Av', '233 St', '225 St', '219 St', 'Gun Hill Rd', 'Burke Av', 'Allerton Av', 'Pelham Pkwy', 'Bronx Park East', 'E 180 St', 'West Farms Sq - E Tremont Av', '174 St', 'Freeman St', 'Simpson St', 'Intervale Av', 'Prospect Av', 'Jackson Av', '149 St - Grand Concourse', '138 St - Grand Concourse', '125 St', '86 St', '59 St', 'Grand Central - 42 St', '14 St - Union Sq', 'Brooklyn Bridge - City Hall', 'Fulton St', 'Wall St', 'Bowling Green', 'Borough Hall', 'Nevins St', 'Atlantic Av', 'Franklin Av', 'President St', 'Sterling St', 'Winthrop St', 'Church Av', 'Beverly Rd', 'Newkirk Av', 'Flatbush Av - Brooklyn College'],
      '6':['Pelham Bay Park', 'Buhre Av', 'Middletown Rd', 'Westchester Sq - E Tremont Av', 'Zerega Av', 'Castle Hill Av', 'Parkchester', 'St Lawrence Av', 'Morrison Av- Sound View', 'Elder Av', 'Whitlock Av', 'Hunts Point Av', 'Longwood Av', 'E 149 St', "E 143 St - St Mary's St", 'Cypress Av', 'Brook Av', '3 Av - 138 St', '125 St', '116 St', '110 St', '103 St', '96 St', '86 St', '77 St', '68 St - Hunter College', '59 St', '51 St', 'Grand Central - 42 St', '33 St', '28 St', '23 St', '14 St - Union Sq', 'Astor Pl', 'Broadway-Lafayette St', 'Spring St', 'Canal St', 'Brooklyn Bridge - City Hall'],
      '6E':['Not Available Yet'],
      '7':['Not Available Yet'],
      '7E':['Not Available Yet'],
      'A':['Not Available Yet'],
      'B':['Not Available Yet'],
      'C':['Not Available Yet'],
      'D':['Not Available Yet'],
      'E':['Not Available Yet'],
      'F':['Not Available Yet'],
      'G':['Not Available Yet'],
      'J':['Not Available Yet'],
      'L':['Not Available Yet'],
      'M':['Not Available Yet'],
      'N':['Not Available Yet'],
      'Q':['Not Available Yet'],
      'R':['Not Available Yet'],
      'S':['Not Available Yet'],
      'W':['Not Available Yet'],
      'Z':['Not Available Yet']}









      var line = "R";//the 6 train. all lines should be a one character string, letter lines should be capitalized
      document.getElementById("lineText").textContent = "Commute for R Train";
      // const startS = "Astor Pl";//start and end station must exactly match station names given in stops.txt
      // const endS = "103 St";
      const ATime = "0900";// time of day in string format ranging from 0000 (12:00AM) to 2359 (11:59PM)
      const ADate = "Weekday";// day of week in string format, can only be "Weekday", "Saturday", or "Sunday"
      let SS = document.getElementById("sStation").value;
      let ES = document.getElementById("eStation").value;
      var cText = document.getElementById("confidence-text");
      var cSlider = document.getElementById("confidence-slider");
      cSlider.style.display ="none";
      var confidences = Array(101).fill(0);
      var i;
      // cSlider.style.display ="none";

      cSlider.oninput = function() {
          console.log("slider changed")
          console.log(this.value)
          console.log(confidences)
          cText.innerHTML = parseInt(this.value)+"% of historical trips took"+parseInt(confidences[this.value])+"minutes or less.";
      }

      async function requestCommute(TrainLine, StartStation, EndStation, ArrivalTime, ArrivalDate){
        const data = {TrainLine, StartStation, EndStation, ArrivalTime, ArrivalDate};
        const commuterequest = {
            method: 'POST',
            headers:{
              'Content-Type':'application/json'
            },
            body: JSON.stringify(data)
            
          }

        const response = await fetch('/commuterequest',commuterequest);
        const response_data = await response.json();
        return response_data;
      }
      function setLine(a){
        line = a;
        document.getElementById("lineText").textContent = "Commute for "+a+" Train";
      }

      async function getCommute(){

        document.getElementById("return").innerHTML = "Calculating...";
        cSlider.style.display ="none";
        cText.innerHTML = "";

        console.log("requesting commute time");
        var startS = document.getElementById("sStation").value;
        var endS = document.getElementById("eStation").value;

        requestCommute(line,startS,endS,ATime,ADate).then(response =>{
        commute_data = response;
        console.log(commute_data);
        console.log(commute_data.data["status"])
        if (commute_data.data["status"]==="failure"){
          document.getElementById("return").innerHTML ="Error: analysis failed to find any data for this commute." 
        }
        else{
          document.getElementById("return").innerHTML ="Expected Commute Time: " + commute_data.data["mean-commute"] + " mins.";
          document.getElementById("confidence-slider").style.display ="inline-block";

          for (i = 0;i<confidences.length;i++){
            confidences[i]=commute_data.data["confidence-commute"][i];
          }

        }
        
        // document.getElementById("data").innerHTML = JSON.stringify(commute_data);

      });}


    </script>
    
  </body>
  <script>
    
  </script>
</html>